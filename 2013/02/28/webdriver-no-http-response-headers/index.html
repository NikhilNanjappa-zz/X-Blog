<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Thoughts on latest technologies">

    <title>Webdriver No Http Response Headers - Xebia Blog</title>

    <link rel="canonical" href="http://xebia.com/2013/02/28/webdriver-no-http-response-headers/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Xebia Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header" style="background-image: url('/img/default-blog-pic.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Webdriver No Http Response Headers</h1>
                    
                    <span class="meta">Posted by prachinagpal on February 28, 2013</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

				<h1>Webdriver: No HTTP Response Headers</h1>

<p>Recently, in my project we came across a situation where headers were to be passed in the application via URL. We tried passing it through many inbuilt functions which are present in Webdriver but failed to do that. After struggling for one day, we realized that Webdriver misses this functionality of passing HTTP headers and showing it in the reponse headers. Selenium developers have taken this decision of not adding this feature to Webdriver since it will suffer its overall quality. It is logged as <a href="https://code.google.com/p/selenium/issues/detail?id=141">issue #141</a>   and is marked as &quot;won&#39;t fix&quot; after all the discussions.</p>

<p>So the solution is,  if we want to test HTTP request/response headers, then we have to write an appropriately customized tests. All we need is a simple HTTP client library (<a href="https://code.google.com/p/selenium/wiki/HtmlUnit">HtmlUnit </a>already offers some of these capabilities but it runs in a headless java browser with limited support so it might not run all your test cases). If we really want to test the response headers then, we need to setup a proxy for the browsers so that we can capture net traffic and modify headers there.</p>

<p>WebDriver is concerned with driving the browser. In the case of inspecting HTTP traffic, the only way to do this in a cross-browser way is via a proxy. WebDriver exposes APIs to make it easy to set the proxy to use for a browser instance, so you can hook in whichever is the most suitable tool for your project. We also used Fiddler, a commercial tool to capture the headers.Selenium is a browser automation framework, not an HTTP recording framework, and as such HTTP recording and manipulation is out of scope for the project. In the common case, where http headers are not required, we can still run without an additional server. But in the case where that data is important to us, we will need a separate server. A proxy solution, will work for every browser, and provide us with status codes, HTTP headers, and much more information.To mention, Proxy Server is a small library named Browser Mob Proxy which is open source and availlable on <a href="https://github.com/webmetrics/browsermob-proxy">github</a>:</p>

<p>The simple workaround is to write the response code . So, we created the following piece of code using ProxyServer in my selenium framework to pass headers in the URL :-</p>

<p><em><strong>Steps to intercept Web Requests and modify Headers:</strong></em> <strong>1.</strong> In your Selenium test suite, initialize proxy server as a global variable and start it in before running any test in the suite</p>

<p>[sourcecode lang=&quot;text&quot;] ProxyServer server = new ProxyServer(4444); server.start();</p>

<p>[/sourcecode]</p>

<p><strong>2.</strong> Create a Generic method which takes a list of headers and then adds a requestInterceptor on the proxy server. Inside the interceptor, we can pass the headers and write them onto the incoming request.</p>

<p>[sourcecode lang=&quot;text&quot;]</p>

<p>if ( headersList!= null &amp;&amp; !headersList.isEmpty()) { for (Entry<String,String> header : headersList.entrySet()) { server.addHeader(header.getKey(), header.getValue()); } }</p>

<p>[/sourcecode]</p>

<p><strong>3.</strong> Now call this generic method in every test case where you want to modify some request headers. IMPORTANT: Make sure that you explicitly clear out any interceptors that might have added in previous test cases since this generic method would be called from all such test cases.</p>

<p>[sourcecode lang=&quot;text&quot;]</p>

<p>// get the Selenium proxy object Proxy proxy = server.seleniumProxy();</p>

<p>if(browserName.equalsIgnoreCase(&quot;firefox&quot;)){ FirefoxProfile ffprofile = new FirefoxProfile(); ffprofile.setPreference(&quot;network.proxy.http&quot;, &quot;localhost&quot;); ffprofile.setPreference(&quot;network.proxy.http<em>port&quot;, 4444); ffprofile.setPreference(&quot;network.proxy.ssl&quot;, &quot;localhost&quot;); ffprofile.setPreference(&quot;network.proxy.ssl</em>port&quot;, 4444); ffprofile.setPreference(&quot;network.proxy.type&quot;, 1); ffprofile.setPreference(&quot;network.proxy.no<em>proxies</em>on&quot;, &quot;&quot;); ffprofile.setAcceptUntrustedCertificates(true); ffprofile.setAssumeUntrustedCertificateIssuer(true); ffprofile.setPreference( &quot;webdriver<em>assume</em>untrusted_issuer&quot;, &quot;false&quot;);</p>

<p>[/sourcecode]</p>

<p><strong>4.</strong> Now add the proxy server instance while setting up the capabilities of the browser desired for testing.</p>

<p>[sourcecode lang=&quot;text&quot;] DesiredCapabilities capabilities = new DesiredCapabilities(); capabilities.setCapability(FirefoxDriver.PROFILE,ffprofile); capabilities.setCapability(CapabilityType.PROXY, proxy); driver = new FirefoxDriver(capabilities); } else if(browserName.equalsIgnoreCase(&quot;internetexplorer&quot;)){ DesiredCapabilities iecapabilities = DesiredCapabilities .internetExplorer(); iecapabilities.setCapability(&quot;ignoreProtectedModeSettings&quot;, &quot;true&quot;); iecapabilities .setCapability( InternetExplorerDriver.INTRODUCE<em>FLAKINESS</em>BY<em>IGNORING</em>SECURITY_DOMAINS, &quot;true&quot;); iecapabilities.setCapability(CapabilityType.PROXY, proxy); driver = new InternetExplorerDriver(iecapabilities); } else if(browserName.equalsIgnoreCase(&quot;chrome&quot;)){</p>

<p>DesiredCapabilities chromeCapabilities = DesiredCapabilities.chrome(); chromeCapabilities.setCapability(&quot;chrome.switches&quot;, Arrays.asList(&quot;--start-maximized&quot;,&quot;--ignore-certificate-errors&quot;)); // added capability for proxy server for adding custom headers chromeCapabilities.setCapability(CapabilityType.PROXY, proxy);</p>

<p>//chromeCapabilities.setCapability(&quot;chrome.switches&quot;, Arrays.asList(&quot;--ignore-certificate-errors&quot;)); ChromeDriverService service = new ChromeDriverService.Builder().usingAnyFreePort().usingDriverExecutable(new File(&quot;chromedriver.exe&quot;)).build(); service.start(); driver = new ChromeDriver(service,chromeCapabilities);</p>

<p>}</p>

<p>[/sourcecode]</p>

<p><strong>5.</strong> Now run the test and intercept all the requests using fiddler.(<a href="http://www.fiddler2.com/fiddler2/">Fiddler</a> was also not able to capture all the headers. So,a tool called <a href="http://www.wireshark.org/download.html">Wireshark </a> can be used to do the same). *<em>6. *</em>Verify if the customized headers have been added/updated in your web request.</p>

<p>So, the above piece of code helped me in adding HTTP headers with the request.</p>


                <hr>

                <div id="disqus_thread"></div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'xebiaww'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2013/02/28/liquibase-a-database-change-tracking-tool/" data-toggle="tooltip" data-placement="top" title="Liquibase A Database Change Tracking Tool">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2013/03/07/reporting-with-jasperreports/" data-toggle="tooltip" data-placement="top" title="Reporting With Jasperreports">Next Post &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/XebiaIndia">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://www.facebook.com/XebiaIndia">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/xebiaww">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; Xebia Blog 2015</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


</body>

</html>
