<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Thoughts on latest technologies">

    <title>Extending Selenium Grid Capabilities - Xebia Blog</title>

    <link rel="canonical" href="http://xebia.com/2014/08/30/extending-selenium-grid-capabilities/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Xebia Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header" style="background-image: url('/img/default-blog-pic.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Extending Selenium Grid Capabilities</h1>
                    
                    <span class="meta">Posted by jgupta on August 30, 2014</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

				<h1>Extending Selenium Grid capabilities</h1>

<p>Selenium 2.xx has built-in Grid Functionality which provides support for distributed test execution i.e. multiple test automation scripts can be run at the same time on different machines running on different OS and browsers. Grid uses a DefaultCapabilityMatcher to match the machine(Node) requested by test script in the grid setup. Currently it uses only the Platform, Browser and its version to find the requested node. This can be extended to match the RAM or the System Type or any other Machine configuration to decide the node.  <strong>Why?</strong></p>

<p>Suppose you have a grid with 100 nodes and you want to run your tests on 64-bit machines to check for specific errors or their performance on this system type. You have 100 proxies to deal with. You will have to go and check the system type of each, and unregister the nodes that have 32-bit or any other system type. This becomes very tedious job. To make this simple, we can extend the existing DefaultCapabilitMatcher class to add a capability to match the system type. Once this is done, grid will make sure to execute tests on the machines with the right capabilities.</p>

<p><strong>Setting up</strong></p>

<p>Open the <a href="https://code.google.com/p/selenium/source/browse/java/server/src/org/openqa/grid/internal/utils/DefaultCapabilityMatcher.java?spec=svn95dd5912a5c741eacf1c0ea9a37abd494deb79d8&amp;name=selenium-2.23.0&amp;r=95dd5912a5c741eacf1c0ea9a37abd494deb79d8" title="DefaultCapabilityMatcher">DefaultCapabilityMatcher</a> code and go through the logic of “matches” method. This is responsible for checking if the capability (OS, Browser and Version) requested by Test script is available with the grid. We can also write this method from scratch by directly Implementing the interface <a href="https://code.google.com/p/selenium/source/browse/java/server/src/org/openqa/grid/internal/utils/CapabilityMatcher.java" title="CapabilityMatcher">CapabilityMatcher</a>.</p>

<p>For now, we want to keep the existing code to match OS, browser and version as it is, and just add a feature to match the system type also. Let us see how we can get this going.</p>

<p>1.Add a new Java Project in Eclipse. Name it as “ExtendingGrid”. 2.Add a new Class “MyCapabilityMatcher”. 3.Add the latest selenium-server-standalone jar to the project class path. 4.Write the code to include capabilities for OS Type or installed RAM.</p>

<p><strong>Writing code to extend DefaultCapabilityMatcher</strong></p>
<div class="highlight"><pre><code class="language-text" data-lang="text"> import org.openqa.grid.internal.utils.DefaultCapabilityMatcher; import java.util.Map;

public class MyCapabilityMatcher extends DefaultCapabilityMatcher { private final String nodeOS = &quot;nodeOS&quot;; boolean allCapabilitiesAvailability = false; @Override public boolean matches(Map&lt;String, Object&gt; nodeCapability, Map&lt;String, Object&gt; requestedCapability) { boolean defaultCapabilitiesAvailability = super.matches(nodeCapability, requestedCapability); if (! requestedCapability.containsKey(nodeOS)){ return defaultCapabilitiesAvailability; } else{ boolean nodeOSAvailability = nodeCapability.get(nodeOS).equals(requestedCapability.get(nodeOS)); allCapabilitiesAvailability = (defaultCapabilitiesAvailability &amp;&amp; nodeOSAvailability); return allCapabilitiesAvailability; } } } 
</code></pre></div>
<p><strong>How it works:</strong></p>

<p>This class will first get the result of matching the original default capabilities and save it in defaultCapabilitiesAvailability. It will then check if the user has requested for the System Type also. If the test script has not asked for any specific system type, then this program will return the result of default capabilities availability. In case, the test script has asked for a system type Eg: 64-bit, then the code will reach the else block. Here it will check if the requested 64-bit OS is there in the available nodes, and return the result. To test the above code, we can write a test script requesting for 64-bit OS as given below.</p>

<p><strong>Writing Selenium Webdriver Test requesting 64-bit OS</strong></p>
<div class="highlight"><pre><code class="language-text" data-lang="text"> import java.net.MalformedURLException; import java.net.URL; import org.openqa.selenium.remote.DesiredCapabilities; import org.openqa.selenium.remote.RemoteWebDriver;

public class sampleTest { public static void main ( String [] args){ DesiredCapabilities capabilities = new DesiredCapabilities(); capabilities.setBrowserName(&quot;firefox&quot;); capabilities.setCapability(&quot;nodeOS&quot;, &quot;64-bit&quot;); RemoteWebDriver remoteWD = null; try{ remoteWD = new RemoteWebDriver( new URL(&quot;http://127.0.0.1:4444/wd/hub&quot;), capabilities); }catch(MalformedURLException e){ e.printStackTrace(); } remoteWD.get(&quot;http://www.xebia.com&quot;); //Add your code to test different things remoteWD.quit(); } } 
</code></pre></div>
<p><strong>Steps to run the test</strong></p>

<p>To use this in our Grid setup, we need to create a jar for the above project. Place it along with selenium standalone jar and add both of them to the classpath. Here is the sample command to start the hub:</p>

<p><strong>&gt;java -cp *;. org.openqa.grid.selenium.GridLauncher -role hub -capabilityMatcher MyCapabilityMatcher</strong></p>

<p>This will start Hub at the default port 4444. We need to specify the capability while starting the node:</p>

<p><strong>&gt;java -jar selenium-server-standalone-2.42.2.jar -role node -hub http://127.0.0.1:4444/grid/register -browser browserName=firefox,maxInstances=3,nodeOS=64-bit</strong></p>

<p>This will start the Node at the default port 5555. All the tests that request for 64-bit OS and firefox browser or just firefox browser will be routed to this node. To confirm the configuration, launch browser and try to access the grid at http://localhost:4444/grid/console#.</p>

<p>You should get something like this:</p>

<p><img src="http://xebee.xebia.in/wp-content/uploads/2014/08/Configuration.png" alt="Configuration">In the above page, you can see that the node is using MyCapabilityMatcher and has a 64-bit OS. Now you can run the tests and it will find the machine with 64-bit OS and run the test. If we modify the test script to ask for a 32-bit OS and if it is not available in the grid, then it will give an error saying the new session cannot find the Capabilities.</p>

<p><strong>Conlusion:</strong></p>

<p>Extending Grid capabilities will not only help to manage the nodes better, it will also give a better idea about what is going on during test script execution and help in debugging test failures.</p>


                <hr>

                <div id="disqus_thread"></div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'xebiaww'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2014/08/29/override-alfresco-custom-authentication-system/" data-toggle="tooltip" data-placement="top" title="Override Alfresco Custom Authentication System">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2014/09/02/alfresco-dwg-file-extension-with-full-text-search-support/" data-toggle="tooltip" data-placement="top" title="Alfresco Dwg File Extension With Full Text Search Support">Next Post &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/XebiaIndia">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://www.facebook.com/XebiaIndia">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/xebiaww">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; Xebia Blog 2015</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


</body>

</html>
