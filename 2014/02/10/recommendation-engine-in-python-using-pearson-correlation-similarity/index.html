<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Thoughts on latest technologies">

    <title>Recommendation Engine In Python Using Pearson Correlation Similarity - Xebia Blog</title>

    <link rel="canonical" href="http://blog.xebia.in/2014/02/10/recommendation-engine-in-python-using-pearson-correlation-similarity/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Xebia Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header" style="background-image: url('/img/default-blog-pic.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Recommendation Engine In Python Using Pearson Correlation Similarity</h1>
                    
                    <span class="meta">Posted by gagrawal on February 10, 2014</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">

        <div class="row">
          <!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=shekhargulati" async="async"></script>

            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
              <h4>Reading time about 5  minutes</h4>

              <h1>Recommendation Engine in Python using Pearson Correlation Similarity</h1>

<p>Recommendation Engine is a tool with which an application can recommend items to it’s users. There are various strategies to develop a recommendation engine depending upon the use case, but “Collaborative Filtering” is the most popular and widely used technique. With collaborative filtering, an application can find people with similar taste and can look at things they like and combine them to create a ranked list of suggestions which is known as user based recommendation. Or can also find items which are similar to each other and then suggest the items to users based on their past purchases which is known as item based recommendation. The first step in this technique is to find users with similar tastes or items which share similarity. There are various similarity models like Cosine Similarity, Pearson Correlation Similarity, Euclidean Distance Similarity etc. which can be used to find similarity between users or items. In this blog post I am going to discuss an example of how one can develop a basic recommendation engine in Python using Pearson Correlation Similarity.</p>

<p><strong>&gt;&gt; MovieLens Data</strong></p>

<p>There are ample sample data sets available on net to do experiments. I will be using MovieLens data set available from <a href="http://grouplens.org/datasets">http://grouplens.org/datasets</a> which contains movies and ratings given by users to these movies. Using this dataset, I will write a python program to give movie recommendations to users. There are two datasets available. I will be using 100,000 dataset in this blog post. After you download and unzip the dataset there are two files u.item and u.data which contain following data </p>

<ul>
<li><strong>u.item</strong> – Contains a list of movie IDs, titles and other details which we are not much concerned with. 

<ul>
<li>e.g. 

<ul>
<li>1|Toy Story (1995)|01-Jan-1995|..</li>
<li>2|GoldenEye (1995)|01-Jan-1995|..</li>
<li>3|Four Rooms (1995)|01-Jan-1995|..</li>
</ul></li>
</ul></li>
<li> <strong>u.data</strong> – Contains actual ratings given by user to these movies in the format user ID, movie ID, rating and timestamp. 

<ul>
<li>e.g. 

<ul>
<li>196         242         3              881250949</li>
<li>186         302         3              891717742</li>
<li>22           377         1              878887116
With this data set available, let’s first write a function in Python which will parse movie and user ratings file and using Pearson Correlation Similarity find similar movies.</li>
</ul></li>
</ul></li>
</ul>

<p><strong>&gt;&gt; Python Program - movieRecommendations.py</strong></p>

<p>Create a python file movieRecommendations.py and write loadMoviesRatings function which is responsible for parsing movie and user ratings file and creating a dictionary:</p>

<p>[sourcecode language=&quot;python&quot;] def loadMovieRatings(): movies={} for line in open(&quot;data/ml-100k/u.item&quot;): (id,movie)=line.split(&quot;|&quot;)[0:2] movies[id]=movie movieRatings={} for line in open(&quot;data/ml-100k/u.data&quot;): (userId, movieId, rating, ts) = line.split(&quot;\t&quot;) movieRatings.setdefault(userId,{}) movieRatings[userId][movies[movieId]]=float(rating) return movieRatings</p>

<p>[/sourcecode]</p>

<p>Now let’s execute this function on python command line to see what is the output.</p>

<p>[sourcecode language=&quot;python&quot;] &gt;&gt;&gt;import movieRecommendations &gt;&gt;&gt;movieRatings=movieRecommendations.loadMovieRatings() &gt;&gt;&gt;movieRatings [/sourcecode]</p>

<p>This returns a dictionary in following format where key is user ID and value is movie name and rating given by respective user:</p>

<p>[sourcecode language=&quot;python&quot;] { 1 : { &#39;Doom Generation, The (1995)&#39;: 2.0, &#39;Twelve Monkeys (1995)&#39;: 4.0, &#39;Mask, The (1994)&#39;: 4.0, &#39;To Wong Foo, Thanks for Everything! Julie Newmar (1995)&#39;: 3.0 … }, 2 : { &#39;River Wild, The (1994)&#39;: 3.0, &#39;Sabrina (1995)&#39;: 3.0, &#39;Evita (1996)&#39;: 3.0, &#39;Richard III (1995)&#39;: 2.0, &#39;Postino, Il (1994)&#39;: 4.0, &#39;Donnie Brasco (1997)&#39;: 4.0 … } } [/sourcecode]</p>

<p><strong>&gt;&gt; Finding users with similar taste : Pearson Correlation Similarity</strong></p>

<p>Once we have above data structure we can now write a function to find users with similar taste. We will use Pearson correlation similarity in this case. The correlation coefficient is a measure of how well two sets of data fit on a straight line. It tends to give better result in situations where data is not normalized. In this case it is possible that some users rate movies more harshly as compared to other users. However it doesn’t mean they are not similar. Pearson correlation score normalizes such data and finds out similar users.</p>

<p>[sourcecode language=&quot;python&quot;] def calculatePearsonSimilarity(movieRatings,u1,u2): movies={} for movie in movieRatings[u1]: if movie in movieRatings[u2]: movies[movie]=1 noOfMovies=len(movies)</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">    if noOfMovies==0: return 0
    sum1=sum([movieRatings[u1][movie] for movie in movies])
    sum2=sum([movieRatings[u2][movie] for movie in movies])

    sum1Sq=sum([pow(movieRatings[u1][movie],2) for movie in movies])
    sum2Sq=sum([pow(movieRatings[u2][movie],2) for movie in movies])

    pSum=sum([movieRatings[u1][movie]*movieRatings[u2][movie] for movie in movies])

    # Calculate Pearson score
    num=pSum-(sum1*sum2/noOfMovies)
    den=sqrt((sum1Sq-pow(sum1,2)/noOfMovies)*(sum2Sq-pow(sum2,2)/noOfMovies))
    if den==0: return 0
    r=num/den
    return r
</code></pre></div>
<p>[/sourcecode]</p>

<p>Above function returns value between -1 and 1. A value of 1 means two users have exactly same ratings for every movie. Let’s now try this function with 2 users and see how similar they are –</p>

<p>[sourcecode language=&quot;python&quot;] &gt;&gt;&gt;import imp &gt;&gt;&gt;imp.reload(movieRecommendations) &gt;&gt;&gt;movieRecommendations.calculatePearsonSimilarity(movieRatings, ‘1’,’2’) 0.16084123285437085 [/sourcecode]</p>

<p>Here the output is 0.16 which means user ‘1’ and ‘2’ are not very similar in terms of their ratings for movies.</p>

<p><strong>&gt;&gt; Weighted Similarity Score</strong></p>

<p>Now let’s say we want movie recommendations for user with id ‘43’.  What we need is to find top n users who have given similar ratings as compared to user ‘43’. And then find the movies which they have rated good and user ‘43’ has still not rated, so that we can recommend the same to user ‘43’. However it is possible that top n users might have given different ratings to same movies that user ’43’ has not watched. Also it is possible that not all users would have watched the same movie. So we need to give weighted score to movies by considering ratings from all top n users and rank them to give correct recommendation to user ‘43’.</p>

<p>Following table illustrates how this can be done. First column contains user IDs and second column contains their similarity with user ‘43’. Now suppose that there are 3 movies i.e. Start Kid, Visitors, The (Visisteurs, Les) and Saint of Fort Washington that user ‘43’ has not rated. We can multiply their respective ratings given by users in first column  with their similarity with user ‘43’ as in second column and then take total of this product and divide by sum of all similarities. This gives us weighted score for all 3 movies as mentioned in last row “Total/Similarity Total” </p>

<p><strong>Users</strong>
<strong>Similarity</strong>
<strong>Star Kid (1979)</strong></p>


                <hr>

                <div id="disqus_thread"></div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'xebiaww'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2014/01/23/facebook-album-explorer/" data-toggle="tooltip" data-placement="top" title="Facebook Album Explorer">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2014/02/20/can-introverts-be-good-scrum-masters/" data-toggle="tooltip" data-placement="top" title="Can Introverts Be Good Scrum Masters">Next Post &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/XebiaIndia">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://www.facebook.com/XebiaIndia">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/xebiaww">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; Xebia Blog 2015</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


</body>

</html>
