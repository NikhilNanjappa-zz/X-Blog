<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Thoughts on latest technologies">

    <title>Connect To Facebook In Grails App - Xebia Blog</title>

    <link rel="canonical" href="http://blog.xebia.in/2010/03/06/connect-to-facebook-in-grails-app/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Xebia Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header" style="background-image: url('/img/default-blog-pic.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Connect To Facebook In Grails App</h1>
                    
                    <span class="meta">Posted by sunil.inteti on March 6, 2010</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">

        <div class="row">
          <!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=shekhargulati" async="async"></script>

            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
              <h4>Reading time about 3  minutes</h4>

              <h1>Connect to Facebook in Grails App</h1>

<p>Recently we integrated the Facebook connect plugin in our Grails project. In this post we will see how to connect to facebookÂ  from our application. So that we can allow facebook users to use our Application.First step would be to get the facebook connect button on to our home page. The code for this is below. ** Getting the facebook connect button on our home page and its functionality **</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"> &lt;fb:login-button onlogin=&quot;facebook_onlogin();&quot;&gt;&lt;/fb:login-button&gt; 
</code></pre></div>
<p>Ofcourse we need to add the facebook namespace to our gsp/html page.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"> xmlns:fb=&quot;http://www.facebook.com/2008/fbml&quot; 
</code></pre></div>
<p>1) fb:login-button is an XFBML tag, we need some Facebook-specific JavaScript to actually render it. This line does the trick.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;script type=&quot;text/javascript&quot; src=&quot;http://static.ak.connect.facebook.com/js/api_lib/v0.4/FeatureLoader.js.php&quot;&gt;&lt;/script&gt;
</code></pre></div>
<p>2) Create a cross domain receiver file, which is necessary for secure <a href="http://wiki.developers.facebook.com/index.php/Cross_Domain_Communication">cross-domain communication</a> with Facebook</p>

<p>create a file with a name xd_receiver.htm and put the following contents into it.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt; &lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; &gt; &lt;body&gt; &lt;script src=&quot;http://static.ak.connect.facebook.com/js/api_lib/v0.4/XdCommReceiver.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt; &lt;/body&gt; &lt;/html&gt; 
</code></pre></div>
<p>3) Every connect website is a facebook application and an API key is required. Fortunately we can easily generate an API key from<a href="http://www.facebook.com/developers/"> here</a> , fill in details and submit the application.</p>

<p>4) We need to tell facebook about our API key. We need to put this code in the <body> tag.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;script type=&quot;text/javascript&quot;&gt;FB.init(&quot;3f0ba1d70537bbf9381bca2bbb9f9a93&quot;,&quot;xd_receiver.htm&quot;);&lt;/script&gt;
</code></pre></div>
<p>This tells the facebook about out API key and the location of the out cross domain receiver file. The above points are <a href="http://wiki.developers.facebook.com/index.php/Facebook_Connect_Tutorial1">here</a> in detail.</p>

<p>By this piece of code we can get the fbConnect button on our home page. But when you click it nothing happens as we need to add a the functionality for the function <strong>facebook_onlogin()</strong></p>
<div class="highlight"><pre><code class="language-text" data-lang="text"> function facebook_onlogin() { var uid = FB.Facebook.apiClient.get_session().uid ; var sessionkey = FB.Facebook.apiClient.get_session().session_key;FB.Facebook.apiClient.users_getInfo(uid, new Array(&#39;first_name&#39;,&#39;last_name&#39;,&#39;email&#39;,&#39;pic_square_with_logo&#39;), function(result, ex) { var firstname = result[0][&#39;first_name&#39;] var lastname = result[0][&#39;last_name&#39;] var pic = result[0][&#39;pic_square_with_logo&#39;] document.location.href=&quot;${params.lang}/facebook/subscription?firstname=&quot;+firstname+&quot;&amp;lastname=&quot;+lastname+&quot;&amp;fbuid=&quot;+uid+&quot;&amp;sessionkey=&quot;+sessionkey+&quot;&amp;pic=&quot;+pic;}); }
</code></pre></div>
<p>The code is self explainatory. To be brief, here we are using the javascript library *<em>FeatureLoader.js.php *</em>to contact the Facebook and get details of a facebook user like his first name, last name, his profile picture etc.</p>

<p>We also get his facebook id using <strong>var uid = FB.Facebook.apiClient.get_session().uid ;</strong></p>

<p>If the user doesnt have a facebook session already it prompts the popup to log on to facebook. *<em>If you want to know how it is done *</em>look through the sourcecode <a href="http://static.ak.connect.facebook.com/js/api_lib/v0.4/FeatureLoader.js.php">here</a>. If he is logged in we can get the details of the facebook user like facebook id, first name, last name, email etc.</p>

<p>The trick here is to pass on the details to our custom controller, lets name it FacebookController. More precisely this is the code that is doing that.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">document.location.href=&quot;${params.lang}/facebook/subscription?firstname=&quot;+firstname+&quot;&amp;lastname=&quot;+lastname+&quot;&amp;fbuid=&quot;+uid+&quot;&amp;sessionkey=&quot;+sessionkey+&quot;&amp;pic=&quot;+pic;});
</code></pre></div>
<p>The action name in facebook controller is subscription and in here we can choose to authenticate him in to our application by connecting him to an existing user. This is to say, user doesn&#39;t need to log in to grails application by his username and password but rather use his facebook credentials. I will explain how this can be done in my next blog.</p>

<h2>Comments</h2>

<p><strong><a href="#5554" title="2011-05-05 13:47:03">Stephane</a>:</strong> Hi, In your line var sessionkey = FB.Facebook.apiClient.get<em>session().session</em>key;FB.Facebook.apiClient.users<em>getInfo(uid, new Array(&#39;first</em>name&#39;,&#39;last<em>name&#39;,&#39;email&#39;,&#39;pic</em>square<em>with</em>logo&#39;), function(result, ex) { you list the email. But I think it is not retrieved. And I cannot see it later used in your code. Are you sure you can retrieve it that way ? If so, then try displaying it later oin in the code.. Cheers,</p>

<p><strong><a href="#5688" title="2011-07-08 10:08:13">Free BlackBerry</a>:</strong> A good article Thank you!</p>


                <hr>

                <div id="disqus_thread"></div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'xebiaww'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2010/03/06/authenticating-user-by-his-facebook-credentials/" data-toggle="tooltip" data-placement="top" title="Authenticating User By His Facebook Credentials">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2010/03/08/atllasian-tools-and-doing-agile-better/" data-toggle="tooltip" data-placement="top" title="Atllasian Tools And Doing Agile Better">Next Post &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/XebiaIndia">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://www.facebook.com/XebiaIndia">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/xebiaww">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; Xebia Blog 2015</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58958750-1', 'auto');
  ga('send', 'pageview');

</script>
</body>

</html>
