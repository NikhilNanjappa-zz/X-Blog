<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Thoughts on latest technologies">

    <title>Implementing Generic Functionality In Grails - Xebia Blog</title>

    <link rel="canonical" href="http://blog.xebia.in/2010/08/28/implementing-generic-functionality-in-grails/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Xebia Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header" style="background-image: url('/img/default-blog-pic.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Implementing Generic Functionality In Grails</h1>
                    
                    <span class="meta">Posted by sunil.inteti on August 28, 2010</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">

        <div class="row">
          <!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=shekhargulati" async="async"></script>

            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
              <h4>Reading time about 4  minutes</h4>

              <h1>Implementing Generic functionality  in Grails</h1>

<p>In web applications we have functionalities like auto suggestions , rating objects, adding to favourites etc which repeat themselves in an application and across applications. So it demands to think about implementing a generic way of rating and adding to user favourites etc and follow <strong>DRY</strong> principle. Recently in one of my Grails projects we implemented these functionalities in a generic way so that they are reusable and easy to use. Here in this blog, specifically lets look at how we can implement generic auto suggest functionality in Grails. This idea can be extended for other functionalities as well.</p>

<p>Jquery already provides <a href="http://docs.jquery.com/Plugins/Autocomplete">auto suggest</a> functionality. The question here is making functionality generic so that next time we have to use that its a breeze to use. Lets create a tag which can add the necessary jquery code for a text field to have auto suggest capability.</p>

<p><strong>HTML code :</strong> [sourcecode language=&quot;html&quot;] <g:textField name="city" id="city" value="" /> <g:autoSuggest autoCompleteForId="city" searchObject="com.xebia.Address" searchProperty="city"/> 
```</p>

<p>For searchObject property we must give the fully qualified class name of the domain object. Here we have Address as the domain objects which has a property city in it. The above tag is handled by the following closure in the Taglibrary.</p>

<p><strong>Autocomplete Tag Library:</strong></p>

<p>def autoSuggest = { attrs , body -&gt; def searchObject = attrs.searchObject def searchProperty = attrs.searchProperty def htmlId = attrs.autoCompleteForId def width = attrs.width def contextName = grailsApplication.config.grails.serverURL def actionName = attrs.action ? attrs.action : &#39;autoSuggest&#39; def controllerName = attrs.controller ? attrs.controller : &#39;autocomplete&#39; </p>
<div class="highlight"><pre><code class="language-text" data-lang="text">    String serviceUrl =  createLink(controller:controllerName, action:actionName , absolute:true)

    importScriptsAndCSS(out, contextName, pageScope);

    out &amp;lt;&amp;lt; &amp;quot;&amp;lt;script&amp;gt;  jQuery(function() {&amp;quot;
    out &amp;lt;&amp;lt;    &amp;quot;\$(\&amp;quot;#&amp;quot;+ htmlId+ &amp;quot;\&amp;quot;).autocomplete({ &amp;quot;  
    out &amp;lt;&amp;lt;              &amp;quot; serviceUrl: \&#39;&amp;quot;+ serviceUrl +&amp;quot;\&#39;,&amp;quot;
    out &amp;lt;&amp;lt;        &#39;&#39;&#39;
                    minChars:1,
                    maxHeight:400,
                    zIndex: 9999,
                    deferRequestBy: 0,
                 &#39;&#39;&#39;
    if(width) {
        out &amp;lt;&amp;lt;    &amp;quot;width:&amp;quot;+width+&amp;quot;,&amp;quot;
    }

    out &amp;lt;&amp;lt;    &amp;quot;params: {searchObject:\&#39;&amp;quot;+searchObject+&amp;quot;\&#39;,searchProperty:\&#39;&amp;quot;+searchProperty  + &amp;quot;\&#39;}, &amp;quot;

    out &amp;lt;&amp;lt; &#39;&#39;&#39;
                    noCache: false
                });
        });
         &amp;lt;/script&amp;gt; 
    &#39;&#39;&#39;

}
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">The method importScriptsAndCSS(out, contextName, pageScope) as the name suggests, adds the necessary css and javascript needed only once per page. The auto suggest tag that we use in tandem with a text field captures the property that we need suggestions for on an domain object and adds necessary jquery code to hit a generic AutoSuggestController which will return the matching options in JSON format to jquery. Now lets look at the generic AutoSuggestController code.

**AutoSuggestController**

 def autoSuggest = { log.debug(&quot;Inside the auto complete controller&quot;) def searchObject = params.searchObject def searchProperty = params.searchProperty def queryValue = params.query


        def searchCriteria = grailsApplication.getClassForName(searchObject).createCriteria()
        log.debug &amp;quot;query value is ${queryValue}&amp;quot;
        def results = searchCriteria.list{
            projections {
                groupProperty(searchProperty)
            }
            ilike(searchProperty, &amp;quot;%${queryValue}%&amp;quot;)
            maxResults(5)
        }
        log.debug(&amp;quot;Auto suggest Results  : &amp;quot;+results)
        render createJSONForResults(results, queryValue , searchProperty)
    }
</code></pre></div>
<p>The above code snippet is the action that will be accessed by the jquery which also passes the search Property and Search Object to the controller. Dynamically we determine the domain object by this line of code <strong>grailsApplication.getClassForName(searchObject).createCriteria()</strong></p>

<p>We get the domain object from the fully qualified class name and then create a criteria on the grails domain object. In this criteria we attempt to get the list of objects for which the searchProperty(city) matches. Once we get the list of objects we have to convert the list into JSON object format, so that that is passed back to the jquery to render the auto suggestions.</p>

<p><strong>JSON format can be achieved like this</strong></p>

<p>private String createJSONForResults(def results, String queryValue, String searchProperty) { def resultsArray = results.toArray() StringBuilder resultsJSONObject = new StringBuilder(&quot;{ query : \&#39;${queryValue}\&#39; , suggestions: [&quot;) if(resultsArray.length &gt; 0) { for(int i=0;i&lt;resultsArray.length-1;i++) { String currentProperty = resultsArray[i] currentProperty = &quot;&#39;&quot; + currentProperty + &quot;&#39;,&quot; resultsJSONObject.append(currentProperty) }</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">        def lastResult = resultsArray[resultsArray.length-1]
        String lastElement = &amp;quot;&#39;&amp;quot; + lastResult + &amp;quot;&#39;]}&amp;quot;
        resultsJSONObject.append(lastElement)
        return resultsJSONObject.toString()
    } else {
        resultsJSONObject.append(&amp;quot;]}&amp;quot;)
    }
}
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">This piece of functionality can be used across the Grails applications and can be resued heavily in a single application as well following the DRY principle.

**Conclusion** Following the same way of using a taglibrary and generic controller we can implement the other functionalities like rating objects, using adding favourites and many more using Grails dynamism.



## Comments

**[omarji](#359 &quot;2010-08-30 19:31:15&quot;):** Cool, I would be interested to know how to manage not writing the scripts and css more than once using importScriptsAndCSS() Note: you could use the elvis operator for the ternary ops. if you like :) def controllerName = attrs.controller ?: &#39;autocomplete&#39;

**[Sunil Prakash Inteti](#858 &quot;2010-09-06 09:40:14&quot;):** omarji, Here is the way that you could use for importing css once. [sourcecode lang=&quot;java&quot;] private void importScriptsAndCSS(def out,String contextName,def pageScope ){ def executedOnceAutocomplete try { executedOnceAutocomplete = pageScope.executedOnceAutocomplete } catch(MissingPropertyException b) { //ignore } if(!executedOnceAutocomplete) { out &lt;&lt; &#39;&lt;link rel=\&quot;stylesheet\&quot; href=\&quot;&#39; out &lt;&lt; contextName out &lt;&lt; &#39;/css/autocomplete/autocomplete.css\&quot; /&gt; &#39; out &lt;&lt; &#39;&lt;script src=&quot;&#39; out &lt;&lt; contextName out &lt;&lt; &#39;/js/jquery/jquery.autocomplete.js&quot; &gt;&lt;/script&gt;&#39; pageScope.executedOnceAutocomplete = true; } } 
</code></pre></div>

                <hr>

                <div id="disqus_thread"></div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'xebiaww'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2010/08/27/integrating-spring-3-with-jpa-2/" data-toggle="tooltip" data-placement="top" title="Integrating Spring 3 With Jpa 2">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2010/08/29/the-wmode-nightmare-in-flex-some-workarounds-to-resolve-issues-pertaining-to-wmode-settings-in-flex/" data-toggle="tooltip" data-placement="top" title="The Wmode Nightmare In Flex Some Workarounds To Resolve Issues Pertaining To Wmode Settings In Flex">Next Post &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/XebiaIndia">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://www.facebook.com/XebiaIndia">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/xebiaww">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; Xebia Blog 2015</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58958750-1', 'auto');
  ga('send', 'pageview');

</script>
</body>

</html>
