<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Thoughts on latest technologies">

    <title>Jboss Clustering In 5 Minutes - Xebia Blog</title>

    <link rel="canonical" href="http://blog.xebia.in/2009/12/03/jboss-clustering-in-5-minutes/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Xebia Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="http://xebia.com/" target="_blank">Xebia</a>
                </li>
                <li>
                    <a href="/">Home</a>
                </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header" style="background-image: url('/img/default-blog-pic.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Jboss Clustering In 5 Minutes</h1>
                    
                    <span class="meta">Posted by pallavi on December 3, 2009</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">

        <div class="row">
          <!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=shekhargulati" async="async"></script>

            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
              <h4>Reading time about 3  minutes</h4>

              <!--When one is not Enough. We would like to scale our Middle ware infrastructure to JBoss clustering is simple cost effective solution to achieve scalability, fault tolerance, Fail over & responsiveness. This is setup steps& troubleshooting tips to build a JBoss cluster-->

<h1>JBoss Clustering in 5 minutes</h1>

<p><strong>Building a JBoss Appliaction Server 5.1 Cluster</strong></p>

<p>Having spent a couple of months working on a JBoss App server clustering, I would like to share some thoughts about it.</p>

<p>Clustering of JBoss is relatively straightforward but there are a few gotchas. Simply executing “run -c all” on two AS instances on the same network is enough for them to form a cluster. But there is lot more to it than executing a command to make a working cluster.  This is the most common production scenario. Assume the machines are named &quot;node1&quot; and &quot;node2&quot;, while node1 has an IP address of 192.168.0.101 and node2 has an address of 192.168.0.102.</p>

<p>run -c all -g ProductionCluster -u 239.255.100.100 -b 192.168.0.101 -Djboss.messaging.ServerPeerID=1</p>

<p>run -c all -g ProductionCluster -u 239.255.100.100 -b 192.168.0.102 -Djboss.messaging.ServerPeerID=2</p>

<p>The -c switch says to use the all config, which includes clustering support. The -g switch sets the cluster name, this should be same for all server nodes in a cluster. The -u switch sets the multicast address that will be used for intra-cluster communication. This is generally a IPv4 format, remember this IP should not be in use in your Network. The -b switch sets the address on which sockets will be bound. The -D switch sets system property jboss.messaging.ServerPeerID, from which JBoss Messaging gets its unique id.</p>

<p>The clustering features in JBoss Application Server are built on top of lower level libraries that provide much of the core functionality -</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;li&gt;&lt;strong&gt;JGroups&lt;/strong&gt; which is a toolkit for reliable point-to-point and point-to-multipoint communication. JGroups is used for all clustering-related communications between nodes in a JBoss Cluster.&lt;/li&gt;


&lt;li&gt;&lt;strong&gt;JBoss Cache&lt;/strong&gt; which is a highly flexible clustered transactional caching library.&lt;/li&gt;
</code></pre></div>
<p>So after done with your cluster setup you may like to configure your application for clustering.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;li&gt;&lt;strong&gt;Web Application:&lt;/strong&gt; This aspect involves telling JBoss you want clustering behavior for a particular web app, and it couldn&#39;t be simpler. Just add an empty distributable element to your application&#39;s web.xml file:&lt;/li&gt;





          ...

          ...




&lt;li&gt;&lt;strong&gt;EJBs&lt;/strong&gt; : For EJB2 / EJB3 beans  simply add a clustered element to the bean&#39;s section in the JBoss-specific deployment descriptor, jboss.xml:&lt;/li&gt;







            ....      
            true
</code></pre></div>
<h3><strong>Common Problems &amp; Solution</strong></h3>

<p>If there is firewall is existing in your network then it will not allow JGroups to communicate</p>

<p>Start a Gossip Server:</p>

<p>java -cp $JBOSS<em>HOME\server\all\lib\jgroups.jar;$JBOSS</em>HOME\common\lib\commons-logging.jarorg.jgroups.stack.GossipRouter -port 5555 -bindaddress localhost</p>

<p>Then in the JGroups configuration of the file %JBOSS_HOME\server\all\deploy\ cluster\jgroups-channelfactory.sar\META-INF\jgroups-channelfactory-stacks.xml make the following modifications in all nodes of the cluster: </p>
<div class="highlight"><pre><code class="language-text" data-lang="text">gossip_refresh=&quot;15000&quot; timeout=&quot;2000&quot; num_initial_members=&quot;3&quot;/&gt;
</code></pre></div>
<p>Now, instead of nodes multicasting to find other nodes, they will register and get information about the cluster from the gossip server. If multicasting is not enabled in the network, this means that JGroups will not work by default, which in turns means that JBoss Clustering will not work either. Then enable the TCP protocol for communication by changing the Entity refrence from shared-up to TCP in file %JBOSS_HOME\server\all\deploy\ cluster\jgroups-channelfactory.sar\META-INF\jgroups-channelfactory-stacks.xml. </p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE protocol_stacks [
   &lt;!ENTITY tcp &#39;
....





&#39;&gt;
</code></pre></div>
<p>]&gt; ... &tcp; ...  .... &tcp; ...</p>

<h2>Comments</h2>

<p><strong><a href="#9170" title="2012-07-17 07:05:18">forrest</a>:</strong> Very useful. Thank you</p>


                <hr>

                <div id="disqus_thread"></div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'xebiaww'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2009/12/03/first-look-at-maven-3/" data-toggle="tooltip" data-placement="top" title="First Look At Maven 3">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2009/12/04/doing-it-with-gnome-do/" data-toggle="tooltip" data-placement="top" title="Doing It With Gnome Do">Next Post &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/XebiaIndia">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://www.facebook.com/XebiaIndia">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/xebiaww">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; <a href="http://xebia.com/" target="_blank">Xebia</a> 2015</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58958750-1', 'auto');
  ga('send', 'pageview');

</script>
</body>

</html>
