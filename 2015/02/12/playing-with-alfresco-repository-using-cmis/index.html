<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Playing With Alfresco Repository Using Cmis</title>

        <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,300,600,700' rel='stylesheet' type='text/css'>
        <link href='http://fonts.googleapis.com/css?family=Open+Sans+Condensed:300' rel='stylesheet' type='text/css'>

        <link rel="stylesheet" href="/css/google.css">
        <link rel="stylesheet" href="/css/base.css">

    </head>
    <body>
       <header>
         <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12 pull-right">
             <form class="navbar-form navbar-right" role="search">
             <script>
  (function() {
    var cx = '006895008187340762068:8j3g16d5zty';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
             </form>
           </div>
            <div id="logo">
                <!-- <img src="/img/xebia.jpg" alt=""> -->
            </div>
            <div id="site-heading">
                <h2 class="title">Xebia Blog</h2>
                <h3 class="subtitle">Thoughts on latest technologies</h3>
            </div>
            <ul id="nav">
                 <li class=""><a href="/">Blog</a></li>
                 <li><a href="https://xebia.com/" target="_blank">Xebia</a></li>
            </ul>
       </header>
       <div id="main-contents">

<div class="single-post">
    <div class="container">
        <div class="post-item">
          <!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=shekhargulati" async="async"></script>

            <div class="post-body">
                <div class="meta">
                  <span class="meta">Posted by <a href="/author/Sourabh Aggarwal">Sourabh Aggarwal</a> on </span>
                  <span class="date">12 February 2015</span>
                </div>
                <div class="content">
                    <h1>Playing with Alfresco repository using CMIS</h1>

<p>Before starting with this blog we need to know only one thing why we are using alfresco with CMIS for content access.</p>

<h1>Table of Content :</h1>

<ul>
<li><a href="#what-is-alfresco">What is alfresco and why we are using it?</a></li>
<li><a href="#what-is-cmis">What is CMIS why we are using it with alfresco?</a></li>
<li><a href="#type-of-cmis-binding-in-alfresco">Type of CMIS binding in Alfresco :</a></li>
<li><a href="#getting-repository-id-and-cmis-atom-pub-URL">Get alfresco CMIS repository ID and CMIS Atom Pub binding URL :</a>

<ul>
<li><a href="#getting-repository-id">Getting repository ID for alfresco installation.</a></li>
<li><a href="#cmis-binding-url">Alfresco CMIS AtomPub binding URL.</a></li>
</ul></li>
<li><a href="#how-to-create-session">How to create create session using Apache CMIS and Alfresco open CMIS ?</a>

<ul>
<li><a href="#create-apache-cmis-session">Creating apache CMIS session :</a></li>
<li><a href="#create-alfresco-cmis-session">Creating Alfresco Cmis session :</a></li>
</ul></li>
<li><a href="#use-ticket-instead-of-username-and-password">Use login Ticket instead of username and password :</a></li>
<li><a href="#simple-and-complex-file-operation">Simple and Complex File operations?</a>

<ul>
<li><a href="#type-of-file-object">Type of file Objects in Alfresco using CMIS approach</a>

<ul>
<li><a href="#document-object">Document Object.</a></li>
<li><a href="#alfrescodocument-object">AlfrescoDocument Object.</a><br></li>
</ul></li>
<li><a href="#create-alfresco-cmis-session">Create New Document :</a></li>
<li><a href="#getting-existing-document">Getting existing document :</a></li>
<li><a href="#update-document">Update document :</a></li>
<li><a href="#delete-old-file">Delete old file :</a></li>
</ul></li>
<li><a href="#update-document">Folder Operations in Alfresco :</a>

<ul>
<li><a href="#type-of-folder-object">Type of Folder Objects in Alfresco using CMIS approach</a>

<ul>
<li><a href="#folder-object">Folder Object.</a></li>
<li><a href="#alfrescofolder-object">AlfrescoFolder Object.</a><br></li>
</ul></li>
</ul></li>
</ul>

<h2>What is alfresco and why we are using it? <a id="what-is-alfresco"></a></h2>

<p>Alfresco means Open Air. Alfresco is the one of the most popular Open Source Content Management Platform. Alfresco gain its popularity from 2005 on-wards.
Alfresco can be used for the wide variety of operation like
+ Record Management
+ Content Management or Document Management
+ For Version control repository
+ For simple and complex business process management
+ For digitization of documents
+ For mail room automation
+ For collaboration
+ Access control management system
 many more....
Its all our choice how and where we are use Alfresco for our usability.</p>

<h2>What is CMIS why we are using it with alfresco? <a id="what-is-cmis"></a></h2>

<p>CMIS stands for Content Management Interoperability Services. CMIS is used when we want to access different content repository that follows CMIS standard within one complete system written on top of them or when we want different content repository follows CMIS standard to interact or exchange there data with each others permission. CMIS is the open standard its not given by Alfresco community its given by OASIS for accessing content repository. We will start how to use Apache Chemistry and Alfresco Open CMIS for respective operation:</p>

<p>One most important thing before starting with CMIS in alfresco you should use apache CMIS library along with alfresco open cmis library. But its not necessary if you are not dealing with alfresco session and objects.</p>

<h2>Type of CMIS binding in Alfresco : <a id="type-of-cmis-binding-in-alfresco"></a></h2>

<p><strong>There are three type of CMIS binding which alfresco support:</strong></p>

<ul>
<li>CMIS Web Services binding.</li>
<li>CMIS AtomPub binding.</li>
<li>CMIS Local binding.</li>
</ul>

<p>We are using CMIS AtomPub binding in this case  we can use other also the only difference is in how we create session in each case else all operation are same. Lets start coding...........</p>

<h2>Get alfresco CMIS repository ID and CMIS Atom Pub binding URL : <a id="getting-repository-id-and-cmis-atom-pub-URL"></a></h2>

<p>Below is how we can get Alfresco repository ID and atom pub binding URL</p>

<h2>Getting repository ID for alfresco installation. <a id="getting-repository-id"></a></h2>

<p>** For Getting repository ID for alfresco installation follow following steps :**</p>

<ul>
<li>Hit URL for alfresco installation http://{server}:{post}/alfresco/service/cmis.</li>
<li>Enter your admin user name and password in login popup.</li>
<li>If user have appropriate permission New file xml is downloaded with name cmis.</li>
<li>Open file and get CMIS repository ID in <a href="cmisra:repositoryInfo">cmisra:repositoryInfo</a> between <a href="cmis:repositoryId">cmis:repositoryId</a> tags.</li>
<li>In my case it is 6fc907f9-6790-46b5-9c25-d6855ff8ff5c.
CMIS atom pub URL is same following URL pattern :</li>
</ul>

<h2>Alfresco CMIS AtomPub binding URL. <a id="cmis-binding-url"></a></h2>

<p>http://{server}:{port}/alfresco/service/cmis</p>

<h2>How to create create session using Apache CMIS and Alfresco open CMIS ? <a id="how-to-create-session"></a></h2>

<p>The main reason for creating alfresco session as we can&#39;t user things or standard in alfresco that are not related to CMIS using simple CMIS session like aspects can&#39;t be used using simple CMIS session.</p>

<h2>Creating apache CMIS session :<a id="create-apache-cmis-session"></a></h2>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// default factory implementation</span>
<span class="n">SessionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">SessionFactoryImpl</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
<span class="c1">// map to contain connection parameter any cmis repository using atom pub</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">parameter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
<span class="n">parameter</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">SessionParameter</span><span class="o">.</span><span class="na">USER</span><span class="o">,</span> <span class="s">&quot;admin&quot;</span><span class="o">);</span>
<span class="n">parameter</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">SessionParameter</span><span class="o">.</span><span class="na">PASSWORD</span><span class="o">,</span> <span class="s">&quot;admin&quot;</span><span class="o">);</span>
<span class="n">parameter</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">SessionParameter</span><span class="o">.</span><span class="na">ATOMPUB_URL</span><span class="o">,</span> <span class="s">&quot;http://localhost:9090/alfresco/service/cmis&quot;</span><span class="o">);</span> <span class="n">parameter</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">SessionParameter</span><span class="o">.</span><span class="na">BINDING_TYPE</span><span class="o">,</span> <span class="n">BindingType</span><span class="o">.</span><span class="na">ATOMPUB</span><span class="o">.</span><span class="na">value</span><span class="o">());</span>
<span class="n">parameter</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">SessionParameter</span><span class="o">.</span><span class="na">REPOSITORY_ID</span><span class="o">,</span> <span class="s">&quot;6fc907f9-6790-46b5-9c25-d6855ff8ff5c&quot;</span><span class="o">);</span>
<span class="c1">// getting Instance from User Credential</span>
<span class="k">try</span> <span class="o">{</span>
<span class="c1">// create session</span>
<span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">createSession</span><span class="o">(</span><span class="n">parameter</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div>
<h2>Creating Alfresco Cmis session :<a id="create-alfresco-cmis-session"></a></h2>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// default factory implementation</span>
<span class="n">SessionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">SessionFactoryImpl</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
<span class="c1">// map to contain connection parameter for Alfresco repository using AtomPub Map</span>
<span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">parameter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
<span class="n">parameter</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">SessionParameter</span><span class="o">.</span><span class="na">USER</span><span class="o">,</span> <span class="s">&quot;admin&quot;</span><span class="o">);</span>
<span class="n">parameter</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">SessionParameter</span><span class="o">.</span><span class="na">PASSWORD</span><span class="o">,</span> <span class="s">&quot;admin&quot;</span><span class="o">);</span>
<span class="n">parameter</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">SessionParameter</span><span class="o">.</span><span class="na">ATOMPUB_URL</span><span class="o">,</span> <span class="s">&quot;http://localhost:9090/alfresco/service/cmis&quot;</span><span class="o">);</span> <span class="n">parameter</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">SessionParameter</span><span class="o">.</span><span class="na">BINDING_TYPE</span><span class="o">,</span> <span class="n">BindingType</span><span class="o">.</span><span class="na">ATOMPUB</span><span class="o">.</span><span class="na">value</span><span class="o">());</span>
<span class="n">parameter</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">SessionParameter</span><span class="o">.</span><span class="na">REPOSITORY_ID</span><span class="o">,</span> <span class="s">&quot;6fc907f9-6790-46b5-9c25-d6855ff8ff5c&quot;</span><span class="o">);</span> <span class="n">parameter</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">SessionParameter</span><span class="o">.</span><span class="na">OBJECT_FACTORY_CLASS</span><span class="o">,</span><span class="s">&quot;org.alfresco.cmis.client.impl.AlfrescoObjectFactoryImpl&quot;</span><span class="o">);</span>
<span class="c1">// getting Instance from User Credential</span>
<span class="k">try</span> <span class="o">{</span>
<span class="c1">// create session Session session = factory.createSession(parameter);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span>
<span class="o">{</span>
<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div>
<h2>Use login Ticket instead of username and password :<a id="use-ticket-instead-of-username-and-password"></a></h2>

<p>username :  ROLE<em>TICKET
password : {USER</em>LOGIN_TICKET}</p>

<p>You can get login ticket by using Alfresco login service http://{server}:{port}/alfresco/service/api/login?u={username}&amp;pw={password?}</p>

<h2>Simple and Complex File operations?<a id="simple-and-complex-file-operation"></a></h2>

<p>There are many operation related to file or content we list some of the most rapidly used:</p>

<ul>
<li>Create new document.</li>
<li>Getting existing document.</li>
<li>Update document.</li>
<li>Delete old file.</li>
<li>Create new document :</li>
</ul>

<h2>Type of file Objects in Alfresco using CMIS approach.<a id="type-of-file-object"></a></h2>

<p><strong>1.</strong> Document Object.
<strong>2.</strong> AlfrescoDocument Object.</p>

<h2>Document Object.<a id="document-object"></a></h2>

<p>This object is common in all CMIS approach whether it is alfresco or any other CMIS supported content repository. This Document object can&#39;t be used for dealing alfresco related operations on Document Like :- aspects etc</p>

<h1>AlfrescoDocument Object.<a id="alfrescodocument-object"></a></h1>

<p>This object is related to Alfresco content repository we have to explicity convert CMIS Document Object to AlfescoDocument object when dealing with alfresco related operation using Alfresco open CMIS extension JAR.</p>

<h2>Create New Document :<a id="create-alfresco-cmis-session"></a></h2>

<p><strong>1.</strong> First we need to follow code for creating Alfresco session.</p>

<p><strong>2.</strong> Create object for Alfresco folder or CMIS folder Object for storing document.</p>

<p>Folder path could be any path within alfresco content repository for which user who is accessing it should have permission.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="n">Folder</span> <span class="nf">retriveCMISFolder</span><span class="o">(</span><span class="n">Session</span> <span class="n">session</span><span class="o">,</span> <span class="n">String</span> <span class="n">folderPath</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServiceException</span><span class="o">{</span>
<span class="k">if</span><span class="o">(</span><span class="n">session</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
<span class="k">throw</span> <span class="k">new</span> <span class="nf">ServiceException</span><span class="o">(</span><span class="n">ServiceException</span><span class="o">.</span><span class="na">SuccessCode</span><span class="o">.</span><span class="na">UnauthorisedAccess</span><span class="o">,</span> <span class="s">&quot;NUll or empty Session Object&quot;</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">if</span><span class="o">(</span><span class="n">folderPath</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">folderPath</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()){</span>
<span class="k">throw</span> <span class="k">new</span> <span class="nf">ServiceException</span><span class="o">(</span><span class="n">ServiceException</span><span class="o">.</span><span class="na">SuccessCode</span><span class="o">.</span><span class="na">ApiError</span><span class="o">,</span> <span class="s">&quot;NUll or empty Folder Path&quot;</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">if</span><span class="o">(!</span><span class="n">folderPath</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">&quot;/&quot;</span><span class="o">)){</span>
<span class="k">throw</span> <span class="k">new</span> <span class="nf">ServiceException</span><span class="o">(</span><span class="n">ServiceException</span><span class="o">.</span><span class="na">SuccessCode</span><span class="o">.</span><span class="na">ApiError</span><span class="o">,</span> <span class="s">&quot;Invalid folder path must start and end with /&quot;</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">try</span><span class="o">{</span>
<span class="n">OperationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createOperationContext</span><span class="o">();</span>
<span class="n">context</span><span class="o">.</span><span class="na">setRenditionFilterString</span><span class="o">(</span><span class="s">&quot;cmis:thumbnail&quot;</span><span class="o">);</span>
<span class="k">return</span> <span class="o">(</span><span class="n">Folder</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">getObjectByPath</span><span class="o">(</span><span class="n">folderPath</span><span class="o">,</span> <span class="n">context</span><span class="o">);</span>
<span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span>
<span class="o">{</span>
<span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
<span class="k">throw</span> <span class="k">new</span> <span class="nf">ServiceException</span><span class="o">(</span><span class="n">ServiceException</span><span class="o">.</span><span class="na">SuccessCode</span><span class="o">.</span><span class="na">ApiError</span><span class="o">,</span> <span class="s">&quot;Unable to created folder object with path = &quot;</span><span class="o">+</span> <span class="n">folderPath</span> <span class="o">+</span> <span class="s">&quot; Expected Cause =&quot;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
<span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p><strong>3.</strong> Create document in alfresco folder for which object is created in step 2.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="n">Document</span> <span class="nf">createNewDocument</span><span class="o">(</span><span class="n">String</span> <span class="n">documentName</span><span class="o">,</span> <span class="n">String</span> <span class="n">documentTitle</span><span class="o">,</span> <span class="n">String</span> <span class="n">documentDescription</span><span class="o">,</span> <span class="n">String</span> <span class="n">mimeType</span><span class="o">,</span> <span class="n">Folder</span> <span class="n">folder</span><span class="o">,</span> <span class="n">InputStream</span> <span class="n">oInputStream</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServiceException</span><span class="o">{</span>
<span class="k">if</span><span class="o">(</span><span class="n">documentName</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">documentName</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()){</span>
<span class="k">throw</span> <span class="k">new</span> <span class="nf">ServiceException</span><span class="o">(</span><span class="n">ServiceException</span><span class="o">.</span><span class="na">SuccessCode</span><span class="o">.</span><span class="na">ApiError</span><span class="o">,</span> <span class="s">&quot;Document name is mandatory&quot;</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">if</span><span class="o">(</span><span class="n">documentTitle</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">documentTitle</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()){</span>
<span class="n">documentTitle</span> <span class="o">=</span> <span class="n">documentName</span><span class="o">;</span>
<span class="o">}</span>
<span class="k">if</span><span class="o">(</span><span class="n">documentDescription</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">documentDescription</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()){</span>
<span class="n">documentDescription</span> <span class="o">=</span> <span class="n">documentName</span><span class="o">;</span>
<span class="o">}</span>
<span class="k">if</span><span class="o">(</span><span class="n">oInputStream</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
<span class="n">oInputStream</span> <span class="o">=</span> <span class="n">CreatePdfFile</span><span class="o">.</span><span class="na">createPdfFile</span><span class="o">(</span><span class="n">documentName</span><span class="o">,</span> <span class="n">documentDescription</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">if</span><span class="o">(</span><span class="n">mimeType</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">mimeType</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()){</span>
<span class="n">mimeType</span> <span class="o">=</span> <span class="s">&quot;application/pdf&quot;</span><span class="o">;</span>
<span class="o">}</span>
<span class="c1">//trying to create new document</span>
<span class="k">try</span>
<span class="o">{</span>
<span class="c1">// Setting properties for new document to be created within repository</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">propertiesDocument</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;();</span>
<span class="n">propertiesDocument</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">PropertyIds</span><span class="o">.</span><span class="na">NAME</span><span class="o">,</span> <span class="n">documentName</span><span class="o">);</span>
<span class="n">propertiesDocument</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">PropertyIds</span><span class="o">.</span><span class="na">OBJECT_TYPE_ID</span><span class="o">,</span> <span class="s">&quot;cmis:document,P:cm:titled&quot;</span><span class="o">);</span>
<span class="n">propertiesDocument</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;cm:title&quot;</span><span class="o">,</span> <span class="n">documentTitle</span><span class="o">);</span>
<span class="n">propertiesDocument</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;cm:description&quot;</span><span class="o">,</span> <span class="n">documentDescription</span><span class="o">);</span>
<span class="c1">// Reading the content in Bytes stream and Writing it to new file in</span>
<span class="n">ContentStream</span> <span class="n">contentStream</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">ContentStreamImpl</span><span class="o">(</span><span class="n">documentName</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">mimeType</span><span class="o">,</span> <span class="n">oInputStream</span><span class="o">);</span>
<span class="c1">// creating document with name title and description</span>
<span class="k">return</span> <span class="n">folder</span><span class="o">.</span><span class="na">createDocument</span><span class="o">(</span><span class="n">propertiesDocument</span><span class="o">,</span> <span class="n">contentStream</span><span class="o">,</span> <span class="n">VersioningState</span><span class="o">.</span><span class="na">MAJOR</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span>
<span class="o">{</span>
<span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
<span class="k">throw</span> <span class="k">new</span> <span class="nf">ServiceException</span><span class="o">(</span><span class="n">ServiceException</span><span class="o">.</span><span class="na">SuccessCode</span><span class="o">.</span><span class="na">ApiError</span><span class="o">,</span> <span class="s">&quot;Unable to create document &quot;</span> <span class="o">+</span> <span class="n">documentName</span> <span class="o">+</span> <span class="s">&quot;. &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(),</span> <span class="n">e</span><span class="o">);</span>
<span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<h2>Getting existing document :<a id="getting-existing-document"></a></h2>

<p>FileNode is the node Id of document which we have for all document in Alfresco. We have different node Id for each document in alfresco repository. For getting document node Id we can get all child document under any Folder in repository. There can be other way also to get document in Folder like using name etc.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="n">AlfrescoDocument</span> <span class="nf">retriveAlfrescoDocument</span><span class="o">(</span><span class="n">Session</span> <span class="n">session</span><span class="o">,</span> <span class="n">String</span> <span class="n">fileNode</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServiceException</span><span class="o">{</span>
<span class="k">if</span><span class="o">(</span><span class="n">session</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
<span class="k">throw</span> <span class="k">new</span> <span class="nf">ServiceException</span><span class="o">(</span><span class="n">ServiceException</span><span class="o">.</span><span class="na">SuccessCode</span><span class="o">.</span><span class="na">UnauthorisedAccess</span><span class="o">,</span> <span class="s">&quot;NUll or empty Session Object&quot;</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">if</span><span class="o">(</span><span class="n">fileNode</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">fileNode</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()){</span>
<span class="k">throw</span> <span class="k">new</span> <span class="nf">ServiceException</span><span class="o">(</span><span class="n">ServiceException</span><span class="o">.</span><span class="na">SuccessCode</span><span class="o">.</span><span class="na">ApiError</span><span class="o">,</span> <span class="s">&quot;NUll or empty file Node&quot;</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">try</span><span class="o">{</span>
<span class="k">return</span> <span class="o">(</span><span class="n">AlfrescoDocument</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">getObject</span><span class="o">(</span><span class="n">fileNode</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span>
<span class="o">{</span>
<span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
<span class="k">throw</span> <span class="k">new</span> <span class="nf">ServiceException</span><span class="o">(</span><span class="n">ServiceException</span><span class="o">.</span><span class="na">SuccessCode</span><span class="o">.</span><span class="na">ApiError</span><span class="o">,</span> <span class="s">&quot;unable to convert cmis folder to alfresco folder = &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
<span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<h2>Update document :<a id="update-document"></a></h2>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// getting Instance from User Credential</span>
<span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="c1">//creating session we did it above</span>
<span class="c1">// getting alfresco document</span>
<span class="n">AlfrescoDocument</span> <span class="n">alfrescoDocument</span> <span class="o">=</span> <span class="n">retriveAlfrescoDocument</span><span class="o">(</span><span class="n">session</span><span class="o">,</span> <span class="n">documentId</span><span class="o">);</span>
<span class="c1">// try to edit document description</span>
<span class="k">try</span>
<span class="o">{</span>
<span class="c1">// Map to contain document properties</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">propertiesDocument</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;();</span>
<span class="k">if</span><span class="o">(!</span><span class="n">Utils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">documentName</span><span class="o">)){</span>
<span class="n">propertiesDocument</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">PropertyIds</span><span class="o">.</span><span class="na">NAME</span><span class="o">,</span> <span class="n">documentName</span><span class="o">);</span>
<span class="o">}</span>
<span class="n">propertiesDocument</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">PropertyIds</span><span class="o">.</span><span class="na">OBJECT_TYPE_ID</span><span class="o">,</span> <span class="s">&quot;cmis:document,P:cm:titled&quot;</span><span class="o">);</span>
<span class="k">if</span><span class="o">(!</span><span class="n">Utils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">documentTitle</span><span class="o">)){</span>
<span class="n">propertiesDocument</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;cm:title&quot;</span><span class="o">,</span> <span class="n">documentTitle</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">if</span><span class="o">(!</span><span class="n">Utils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">documentDescription</span><span class="o">)){</span>
<span class="n">propertiesDocument</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;cm:description&quot;</span><span class="o">,</span> <span class="n">documentDescription</span><span class="o">);</span>
<span class="o">}</span>
<span class="c1">// updating document property</span>
<span class="n">CmisObject</span> <span class="n">updateDocument</span> <span class="o">=</span> <span class="n">alfrescoDocument</span><span class="o">.</span><span class="na">updateProperties</span><span class="o">(</span><span class="n">propertiesDocument</span><span class="o">);</span>
<span class="c1">// return document properties</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">updateDocument</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
<span class="k">throw</span> <span class="k">new</span> <span class="nf">ServiceException</span><span class="o">(</span><span class="n">ServiceException</span><span class="o">.</span><span class="na">SuccessCode</span><span class="o">.</span><span class="na">ApiError</span><span class="o">,</span> <span class="s">&quot;unable to edit document with name &quot;</span> <span class="o">+</span> <span class="n">alfrescoDocument</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></div>
<h2>Delete old file :<a id="delete-old-file"></a></h2>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">//creating new session object</span>
<span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="c1">//Create session we did it above</span>
<span class="c1">//alfresco document object</span>
<span class="n">AlfrescoDocument</span> <span class="n">alfrescoDocument</span> <span class="o">=</span> <span class="n">retriveAlfrescoDocument</span><span class="o">(</span><span class="n">session</span><span class="o">,</span> <span class="n">fileNode</span><span class="o">);</span>
<span class="c1">// try to delete document object</span>
<span class="k">try</span> <span class="o">{</span>
<span class="c1">// deleting File with given File ID from repository</span>
<span class="n">alfrescoDocument</span><span class="o">.</span><span class="na">delete</span><span class="o">();</span>
<span class="c1">//return property map for deleting document</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Document deleted successfully&quot;</span><span class="o">);</span>
<span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
<span class="k">throw</span> <span class="k">new</span> <span class="nf">ServiceException</span><span class="o">(</span>
<span class="n">ServiceException</span><span class="o">.</span><span class="na">SuccessCode</span><span class="o">.</span><span class="na">ApiError</span><span class="o">,</span><span class="s">&quot;Unable to delete document with name &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></div>
<p>So these are the file operation we can have in Alfresco there could be more.</p>

<h2>Folder Operations in Alfresco?<a id="folder-operations-in-alfresco"></a></h2>

<p>We can have two type of folder object in CMIS approach :</p>

<h2>Type of folder Objects in Alfresco using CMIS approach.<a id="type-of-folder-object"></a></h2>

<p><strong>1.</strong> Folder Object.
<strong>2.</strong> AlfrescoFolder Object.</p>

<h2>Folder Object.<a id="folder-object"></a></h2>

<p>This object is common in all CMIS approach whether it is alfresco or any other CMIS supported content repository. This folder object can&#39;t be used for dealing alfresco related operations on folders Like :- aspects etc</p>

<h1>AlfrescoFolder Object.<a id="alfrescofolder-object"></a></h1>

<p>This object is related to Alfresco content repository we have to explicitly convert CMIS Folder Object to AlfescoFolder object when dealing with alfresco related operation using Alfresco open CMIS extension JAR.</p>

<p>For code on Alfresco Folder operations we are creating separate bog.</p>

<h2>Full index and metadata search of document using CMIS?<a id="full-index-metadata-search-in-alfresco"></a></h2>

<p>For working with alfresco document search visit our blog <strong><a href="http://blog.xebia.in/2014/11/20/alfresco-custom-field-search-in-cmis-approach/">Alfresco custom field search in CMIS approach</a>.</strong></p>

<p><strong><a href="http://blog.xebia.in/tag/alfresco/">For more hacks about alfresco visit</a></strong></p>

                </div>
            </div>
            <div class="post-tags">
                <i class="fa fa-tags"></i>
                
                <a class="tag_list_link" href="/tag/alfesco">alfesco</a>
                <span class="seperator">,</span>
                
                <a class="tag_list_link" href="/tag/CMIS operations">CMIS operations</a>
                <span class="seperator">,</span>
                
                <a class="tag_list_link" href="/tag/CMIS file, folder and search operations">CMIS file, folder and search operations</a>
                <span class="seperator">,</span>
                
            </div>
            <ul class="post-socials">
              <li><a href="https://www.facebook.com/sharer/sharer.php?u=http://blog.xebia.in/2015/02/12/playing-with-alfresco-repository-using-cmis/&t=Playing With Alfresco Repository Using Cmis" target="_blank"><i class="fa fa-facebook"></i></a></li>
              <li><a href="https://twitter.com/intent/tweet?original_referer=http://blog.xebia.in/2015/02/12/playing-with-alfresco-repository-using-cmis/&text=Playing With Alfresco Repository Using Cmis&url=http://blog.xebia.in/2015/02/12/playing-with-alfresco-repository-using-cmis/" target="_blank"><i class="fa fa-twitter"></i></a></li>
              <li><a href="https://plus.google.com/share?url=http://blog.xebia.in/2015/02/12/playing-with-alfresco-repository-using-cmis/" target="_blank"><i class="fa fa-google-plus"></i></a></li>
            </ul>
        </div>
    </div>
    <div id="blog-pagination">
        <ul>
        	
            <li class="prev"><a href="/2015/01/02/sql-over-hbase-using-apache-pheonix/"><i class="fa fa-angle-left"></i><span>Prev</span></a></li>
            
            
            <li class="separator"></li>
            
            
            <li class="next"><a href="/2015/02/16/Performance-Testing-Using-JMeter-Part-1/"><span>Next</span><i class="fa fa-angle-right"></i></a></li>
            
        </ul>
    </div>

    <hr>
    <div id="disqus_thread"></div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'xebiaww'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    <hr>
</div>

 </div>
       <footer>
            <div id="footer-quote">
                <div class="container">
                    <div class="contents">

                    </div>
                </div>
            </div>
            <div id="bottom">
                <div class="container">
                    <ul id="social-icons">
                        <li><a href="https://www.facebook.com/XebiaIndia" target="_blank"><i class="fa fa-facebook"></i></a></li>
                        <li><a href="https://twitter.com/XebiaIndia" target="_blank"><i class="fa fa-twitter"></i></a></li>
                        <li><a href="https://www.linkedin.com/company/xebia" target="_blank"><i class="fa fa-linkedin"></i></a></li>
                        <li><a href="https://github.com/xebiaww" target="_blank"><i class="fa fa-github"></i></a></li>
                    </ul>
                    <div id="copyright">© COPYRIGHT 2015 @Xebia.  ALL RIGHTS RESERVED</div>
                    <a id="home-circle" href=""><i class="fa fa-home"></i></a>
                </div>
            </div>
       </footer>
       <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58958750-1', 'auto');
  ga('send', 'pageview');

</script>
       <script type="text/javascript" src="/js/jquery-1.11.0.min.js"></script>
       <script type="text/javascript" src="/js/custom.js"></script>
    </body>
</html>

